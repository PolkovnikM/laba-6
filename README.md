# Лабораторная работа 6: Рефакторинг order_processing.py

## Цель работы
Отрефакторить код обработки заказов, улучшив его читаемость и поддерживаемость, не изменив поведение.

## Исходный код
Исходный код содержал одну большую функцию `process_checkout()` длиной 80+ строк, которая выполняла все операции: парсинг запроса, валидацию, расчёты и форматирование.

## Обнаруженные проблемы качества

### 1. Нарушение принципа единственной ответственности (SRP)
Функция `process_checkout()` делала слишком много:
- Парсила входные данные
- Валидировала их
- Выполняла бизнес-расчёты (скидки, налоги)
- Форматировала результат

### 2. "Магические числа" в коде
В коде были "зашиты" числовые константы без пояснений:
- `0.21` — ставка налога
- `0.10`, `0.20`, `0.05` — проценты скидок
- `50`, `10` — фиксированные скидки
- `100`, `200` — пороговые значения

### 3. Высокая цикломатическая сложность
Множество вложенных условий и циклов в одной функции.

### 4. Проблемы с тестируемостью
Невозможно было протестировать отдельные части логики (например, только расчёт скидки).

## Применённые рефакторинги

### 1. Вынесение констант
Все "магические числа" вынесены в именованные константы в начале файла:

```python
TAX_RATE = 0.21
DISCOUNT_RATES = {
    "SAVE10": 0.10,
    "SAVE20": 0.20,  # для заказов >= 200
    "SAVE20_MIN": 0.05,  # для заказов < 200
    "VIP": 50,
    "VIP_MIN": 10,
}
VIP_THRESHOLD = 100
SAVE20_THRESHOLD = 200
DEFAULT_CURRENCY = "USD"
```
### 2. Разделение на функции с чёткими ответственностями
Функция	Ответственность
- parse_request()	Извлечение данных из запроса
- validate_request()	Валидация входных данных
- validate_item()	Проверка корректности товара
- calculate_subtotal()	Подсчёт суммы товаров
- calculate_discount()	Логика скидок
- calculate_tax()	Расчёт налога
- generate_order_id()	Генерация ID заказа
### 3. Улучшение читаемости
- Добавлены docstring к каждой функции — каждая функция теперь имеет документацию

- Замена type(items) is not list на isinstance(items, list) — более питоничный способ проверки типов

- Улучшение имен переменных — it → item (осмысленные имена)
### 4. Упрощение логики
- Использование последовательного выполнения вместо вложенности — убраны глубокие уровни вложенности

- Линейный поток в основной функции — process_checkout() теперь читается как последовательность шагов

- Чёткая последовательность шагов — каждый шаг обработки заказа явно отделён
## Результат рефакторинга
### Что улучшилось:
- Читаемость — код теперь читается как сценарий сверху вниз

- Тестируемость — каждую функцию можно тестировать отдельно

- Поддерживаемость — для изменения скидки нужно править только calculate_discount()

- Переиспользуемость — функции можно использовать в других частях системы
## Статистика изменений:
Исходный размер process_checkout(): 60+ строк

Новый размер process_checkout(): 25 строк (уменьшение на 58%)

Общее количество функций: 9 (было 2)

"Магические числа": 0 (все вынесены в константы)
## Вывод
Рефакторинг позволил превратить монолитную функцию в модульную систему с чёткими ответственностями. Код стал более читаемым, поддерживаемым и подготовленным к будущим изменениям. При этом функциональность полностью сохранена, что подтверждается прохождением всех тестов.

### Основные достижения:

Соблюдение принципа единственной ответственности

Устранение "магических чисел"

Улучшение тестируемости
